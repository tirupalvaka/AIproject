# function_app.py (or a new file that imports the same 'app')
import azure.functions as func
import json, os

@app.route(route="tech-health/latest", methods=["GET"])
def tech_health_latest(req: func.HttpRequest) -> func.HttpResponse:
    try:
        path = "/tmp/tech_health_latest.json"
        if os.path.exists(path):
            with open(path) as f:
                payload = f.read()
        else:
            # safe default for first run
            payload = json.dumps({
                "score": 0, "max": 500, "level": "", "timestamp": ""
            })
        return func.HttpResponse(payload, mimetype="application/json")
    except Exception as e:
        return func.HttpResponse(
            json.dumps({"error": str(e)}),
            mimetype="application/json",
            status_code=500
        )

